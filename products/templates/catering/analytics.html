{% extends "base/base_nav_footer.html" %} 
{% block content %}

<div class="container-fluid">    
    <div class="row">
        <div class="col-md-5">            
            <canvas id="myChart1" width="400" height="300"></canvas>
        </div>
        <div class="col-md-5">
            <canvas id="myChart2" width="400" height="300"></canvas>
        </div>        
        <div class="col-md-2">
            <select class="year_select" id="cat-sold">
                <option value="2017">2017</option>                
                <option value="2018">2018</option>
            </select><br><br>
            <select class="month_select" id="cat-sold">
                <option value="1">Enero</option>
                <option value="2">Febrero</option>
                <option value="3">Marzo</option>
                <option value="4">Abril</option>
                <option value="5">Mayo</option>
                <option value="6">Junio</option>
                <option value="7">Julio</option>
                <option value="8">Agosto</option>
                <option value="9">Septiembre</option>
                <option value="10">Octubre</option>
                <option value="11">Noviembre</option>
                <option value="12">Diciembre</option>
            </select><br><br>
            <select class="type_select" id="cat-sold">
                <option value="select">General</option>
                <option value="drinks_sold" id="drinksValue">Bebidas</option>
                <option value="food_sold" id="food_value">Platillos</option>
            </select>            
        </div>
    </div>
</div>

{% endblock content %} 
{% block javascript %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<script type="text/javascript" charset="utf-8" defer>

    var sales_data = JSON.parse('{{ sales_data | safe }}');  
    var year = "{{today.year}}"
    var month = "{{today.month}}"
    var day = "{{today.day}}"
    var category = "select"

    $(".year_select").val(year);
    $(".month_select").val(month);
    
    function get_cookie(name) {
        let cookie_value = null;
        if (document.cookie && document.cookie !== '') {
            let cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                let cookie = jQuery.trim(cookies[i]);
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookie_value = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookie_value;/**/
    }
    
    function random_rgba() {
        var o = Math.round, r = Math.random, s = 255;
        return 'rgba(' + o(r() * s) + ',' + o(r() * s) + ',' + o(r() * s) + ',' + r().toFixed(1) + ')';
    }

    function get_colors(sales_data) {
        let sale_list = [];
        let count = 0;
        while (count < sales_data.length) {
            sale_list.push(random_rgba());
            count++;
        }
        return sale_list;
    }

    function get_new_data() {
        var csrf_token = get_cookie('csrftoken');
        $.ajax({
            url: '{% url "products:warehouse_analytics" %}',
            type: 'POST',
            data: {
                'type': 'load_date',
                'year': year,
                'month': month,
                'category': selected_category,
                csrfmiddlewaretoken: csrf_token
            },
            datatype: "html",
            success: function (result) {
                
            }
        });
    }

    colors = get_colors(sales_data.names)

    var ctx1 = document.getElementById("myChart1");
    var myChart = new Chart(ctx1, {
        type: 'horizontalBar',
        data: {
            labels: sales_data.names,
            datasets: [{
                label: '# de Ventas',
                data: sales_data.tick_sales,                
                borderColor: colors,
                backgroundColor: colors,
                borderWidth: 1,
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    legend: {
                        position: "left",
                    }
                }
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            },            
        }
    });
    var ctx2 = document.getElementById("myChart2");
    var myChart = new Chart(ctx2, {
        type: 'line',
        data: {
            labels: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15",
                     "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27","28","29","30"],
            datasets: [{
                borderWidth: 1,
                borderColor: "red",
                pointRadius: 4,
                label: "lol",
                data: [100, 20, 30, 40],
                fill: false,
            }, {
                borderWidth: 1,
                borderColor: "blue",
                pointRadius: 4,
                label: "lol2",
                data: [10, 20, 30, 40],
                fill: false,
            },
            ]
        },
    });    

    $(".year_select").on('change', function () {
        yaer = $(this).val();
        get_new_data()
    });

    $(".month_select").on('change', function () {
        month = $(this).val();
        get_new_data()
    });

    $(".type_select").on('change', function () {
        type = $(this).val();
        get_new_data()
    });

    
</script>

{% endblock javascript %}